<!DOCTYPE html>
<html lang="th">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>สมัครสมาชิก | ห้องสมุดออนไลน์</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="cssregister.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
</head>

<body>

  <!-- Navbar -->
  <div class="navbar-container">
    <div class="navbar-top"></div>
    <div class="navbar">
      <div class="navbar-left">
        <img src="https://i.postimg.cc/XvS1jwB8/1.png" alt="โลโก้" />
        <span>โรงเรียนเสนาธิการทหารเรือ</span>
      </div>
      <div class="navbar-right">
        <button onclick="location.href='index.html'">เข้าสู่ระบบ</button>
      </div>
    </div>
    <div class="navbar-bottom"></div>
  </div>

  <!-- Content -->
  <div class="content">
    <div class="register-container">
      <h2>สมัครสมาชิก</h2>
      <form action="index.html" method="GET" id="register-form">
        <div class="form-group">
          <label for="rank">ยศ</label>
          <select id="rank" name="rank" required>
            <option value="">-- กรุณาเลือกยศ --</option>
            <option value="พลเรือเอก">พลเรือเอก</option>
            <option value="พลเรือโท">พลเรือโท</option>
            <option value="พลเรือตรี">พลเรือตรี</option>
            <option value="นาวาเอก">นาวาเอก</option>
            <option value="นาวาโท">นาวาโท</option>
            <option value="นาวาตรี">นาวาตรี</option>
            <option value="เรือเอก">เรือเอก</option>
            <option value="เรือโท">เรือโท</option>
            <option value="เรือตรี">เรือตรี</option>
            <option value="พันจ่าเอก">พันจ่าเอก</option>
            <option value="พันจ่าโท">พันจ่าโท</option>
            <option value="พันจ่าตรี">พันจ่าตรี</option>
            <option value="จ่าเอก">จ่าเอก</option>
            <option value="จ่าโท">จ่าโท</option>
            <option value="จ่าตรี">จ่าตรี</option>
          </select>
        </div>

        <div class="form-group">
          <label for="fullname">ชื่อ-นามสกุล</label>
          <input type="text" id="fullname" name="fullname" required />
        </div>

        <div class="form-group">
          <label for="phone">เบอร์โทรศัพท์</label>
          <input type="tel" id="phone" name="phone" pattern="[0-9]{9,10}" required />
        </div>

        <div class="form-group">
          <label for="student_id">เลขประจำตัว</label>
          <input type="text" id="student_id" name="student_id" required />
        </div>

        <div class="form-group">
          <label for="username">Username</label>
          <input type="text" id="username" name="username" required />
        </div>

        <div class="form-group">
          <label for="password">Password</label>
          <div style="position: relative;">
            <input type="password" id="password" name="password" required style="width: 93%;" />
            <i id="togglePassword" class="fa-solid fa-eye"
              style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); cursor: pointer;"></i>
          </div>
        </div>

        <div class="form-group">
          <label for="course">หลักสูตร</label>
          <select id="course" name="course" required>
            <option value="">-- กรุณาเลือกหลักสูตร --</option>
            <option value="หลักสูตรอาวุโส">หลักสูตรอาวุโส</option>
            <option value="หลักสูตรเสนาธิการทหารเรือ">หลักสูตรเสนาธิการทหารเรือ</option>
          </select>
        </div>

        <div class="form-group">
          <label for="confirmPassword">ยืนยันรหัสผ่าน</label>
          <div style="position: relative;">
            <input type="password" id="confirmPassword" name="confirmPassword" required style="width: 93%;" />
            <i id="toggleCPassword" class="fa-solid fa-eye"
              style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); cursor: pointer;"></i>
          </div>
        </div>

        <div class="form-group full-width">
          <button type="submit">ยืนยัน</button>
        </div>
      </form>

      <div class="login-link">
        มีบัญชีแล้ว? <a href="index.html">เข้าสู่ระบบ</a>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer>
    <div class="footer-top">
      <span>© 2025 โรงเรียนเสนาธิการทหารเรือ</span>
    </div>
    <div class="footer-bottom">
      <span>หากประสบปัญหาโปรดติดต่อ : น.อ.ศักดิ์สิทธิ์ เตชะพงศ์ประเสริฐ โทร. 089-893-8805</span>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script>
    const SUPABASE_URL = 'https://hsraobyushrnafntzksg.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhzcmFvYnl1c2hybmFmbnR6a3NnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA3NDQ5ODgsImV4cCI6MjA2NjMyMDk4OH0.2YTiXCStLyFdkuUNcNa2FP7ygyg70LWrypceSHlGERw';
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY); // ✅ ใช้แบบนี้

    document.getElementById('register-form').addEventListener('submit', async (e) => {
      e.preventDefault();

      const rank = document.getElementById('rank').value;
      const fullname = document.getElementById('fullname').value;
      const phone = document.getElementById('phone').value;
      const student_id = document.getElementById('student_id').value;
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;
      const confirmPassword = document.getElementById('confirmPassword').value;
      const course = document.getElementById('course').value;

      if (password !== confirmPassword) {
        alert("❌ รหัสผ่านไม่ตรงกัน");
        return;
      }

      // ✅ ตรวจ username ซ้ำ
      const { data: existingUser, error: checkError } = await supabase
        .from('profiles')
        .select('username')
        .eq('username', username)
        .single();

      if (existingUser) {
        alert('❌ มี Username นี้อยู่แล้ว');
        return;
      }

      // ✅ Insert ข้อมูล
      const { error: insertError } = await supabase.from('profiles').insert([{
        username,
        password,
        rank,
        fullname,
        phone,
        student_id,
        course
      }]);

      if (insertError) {
        alert('❌ สมัครไม่สำเร็จ: ' + insertError.message);
      } else {
        alert('✅ สมัครสมาชิกสำเร็จ!');
        window.location.href = 'index.html';
      }
    });

    document.getElementById('togglePassword').addEventListener('click', function () {
      const passwordInput = document.getElementById('password');
      const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
      passwordInput.setAttribute('type', type);
      this.classList.toggle('fa-eye');
      this.classList.toggle('fa-eye-slash');
    });

    document.getElementById('toggleCPassword').addEventListener('click', function () {
      const cpasswordInput = document.getElementById('confirmPassword');
      const type = cpasswordInput.getAttribute('type') === 'password' ? 'text' : 'password';
      cpasswordInput.setAttribute('type', type);
      this.classList.toggle('fa-eye');
      this.classList.toggle('fa-eye-slash');
    });

  </script>

</body>

</html>